config:
  target: 'https://scc2122appwesteuropenmp.azurewebsites.net/rest'
#  target: 'http://localhost:8080/scc2122-backend/rest'
  http:
    timeout: 10
  plugins:
    metrics-by-endpoint: {}
  processor: "./test-utils.js"
  variables:
     metricsProcessEndpoint : "myProcessEndpoint"
  phases:
  - name: "Create channels"
    duration: 1
    arrivalCount: 1

scenarios:
  - name: 'Create channels'
    weight: 1
    flow:
      # generate 20 public channels
      - loop:
          - function: "selectUserSkewed"
          - function: "genNewChannel"
          - post:
              url: "/channels"
              auth:
                user: "{{ nickname }}"
                pass: "{{ password }}"
              headers:
                Content-Type: application/json
                Accept: application/json
              json:
                name: "{{ channelName }}"
                private: true
              capture:
                - json: $.id
                  as: "channelId"
          - loop:
              - function: "selectUserSkewed"
              - put:
                  url: "/channels/{{ channelId }}/members"
                  auth:
                    user: "{{ nickname }}"
                    pass: "{{ password }}"
            count: 10
        count: 20

      # generate 45 private channels
      - loop:
        - function: "selectUserSkewed"
        - function: "genNewChannel"
        - post:
            url: "/channels"
            auth:
              user: "{{ nickname }}"
              pass: "{{ password }}"
            headers:
              Content-Type: application/json
              Accept: application/json
            json:
              name: "{{ channelName }}"
              private: true
            capture:
              - json: $.id
                as: "channelId"
        - loop:
          - function: "selectUserSkewed"
          - put:
              url: "/channels/{{ channelId }}/members"
              auth:
                user: "{{ nickname }}"
                pass: "{{ password }}"
          count: 10
        count: 45


